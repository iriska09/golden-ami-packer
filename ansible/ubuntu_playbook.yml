---
- name: Harden Ubuntu Server
  hosts: all
  become: yes
  tasks:
    - name: Update all packages
      apt:
        update_cache: yes
        upgrade: dist
        autoremove: yes

    - name: Install security packages
      apt:
        name:
          - ufw
          - auditd
          - fail2ban
          - unattended-upgrades
        state: present

    - name: Harden SSH configuration
      blockinfile:
        path: /etc/ssh/sshd_config
        block: |
          Protocol 2
          PermitRootLogin no
